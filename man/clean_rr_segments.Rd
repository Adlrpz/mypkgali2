% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/clean_rr_segments.R
\name{clean_rr_segments}
\alias{clean_rr_segments}
\title{Limpieza y segmentación de intervalos RR de registros ECG}
\usage{
clean_rr_segments(rr, rt, ann, p, w, fs, figsavefullpath = NULL)
}
\arguments{
\item{rr}{Vector numérico. Son los intervalos RR en muestras (tiempo entre latidos consecutivos).}

\item{rt}{Vector numérico. Tiempos acumulados en muestras desde el inicio del registro.}

\item{ann}{Vector numérico. Códigos ASCII de tipo de latido (ej. 4='N')}

\item{p}{Valor numérico. Parámetro de sensibilidad para la detección de outliers.}

\item{w}{Entero. Tamaño de la ventana local para la detección de outliers (número de latidos).}

\item{fs}{Entero. Frecuencia de muestreo de los electocardiogramas. 1000 Hz.}

\item{figsavefullpath}{Ruta opcional para guardar las figuras del diagnóstico.}
}
\value{
La función devuelve una lista con 3 elementos:
\describe{
\item{rr_new_all}{Vector numérico. Señal RR procesada, limpia y con interpolaciones aplicadas.}
\item{rt_new_all}{Vector numérico. Tiempos correspondientes a cada intervalo RR en la señal limpia.}
\item{seg_new}{Matriz numérica. Cada fila representa el índice de inicio y fin de un segmento válido.}
}
}
\description{
La función \code{clean_rr_segments()} permite procesar la señal de intervalos RR que se ha obtenido a partir
de los registros ECG (electrocardiogramas) para su posterior análisis, eliminando artefactos, latidos ectópicos,
valores atípicos y tramos de señal de baja calidad
}
\section{Objetivo principal}{

El objetivo principal de la función es reconstruir una señal continua y fisiológicamente plausible por medio de los siguientes pasos:
\itemize{
\item \strong{Exclusión de anotaciones no latido y ectópicas.}
\item \strong{Identificación de latidos anómalos} (outliers) mediante estadística local.
\item \strong{Detección de saltos bruscos} en la señal RR que puedan alterar el análisis.
\item \strong{Evaluación de la calidad de la señal por épocas}, marcando segmentos inestables.
\item \strong{Segmentación de tramos válidos} y eliminación de huecos prolongados (≥ 5 s).
\item \strong{Interpolación de huecos} mediante vecinos válidos, usando interpolación cúbica tipo PCHIP.
}

#' @section Detalles:
\itemize{
\item Se excluyen anotaciones no latido (ej. '+', '|', 's').
\item Se eliminan latidos ectópicos (códigos distintos de 78) y valores fuera de rango fisiológico.
\item Se detectan outliers por ventana deslizante con umbral estadístico.
\item Se invalidan épocas completas si hay menos de 15 latidos válidos, más de 10\\% de ruido,
o menos del 90\\% del tiempo útil.
\item Se segmenta la señal en tramos continuos válidos, excluyendo huecos ≥ 5 segundos.
\item Se interpolan huecos breves usando interpolación cúbica PCHIP (\code{signal::interp1()}).
}
}

\section{Requisitos}{

Necesita el paquete \pkg{signal} para la función \code{interp1()}.
}

\examples{
\dontrun{
# Simulación de una señal con latidos válidos y artefactos
rr <- c(800, 805, 810, NA, NA, 780, 1600, 800, 790, 810)
rt <- cumsum(rr, na.rm = TRUE)
rt <- cumsum(ifelse(is.na(rr), 0, rr))
ann <- rep(78, length(rr))  # todos normales
ann[7] <- 20  # un latido ectópico

resultado <- clean_rr_segments(rr, rt, ann, p = 2, w = 5, fs = 1000)
plot(resultado$rt_new_all, resultado$rr_new_all, type = "l")
}

}
\seealso{
\code{\link{read_ann_file}} para la lectura inicial de archivos .ANN,
y \code{\link[signal]{interp1}} para interpolación de tipo pchip.
}
